<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<PropertyGroup Label="Default_Framework_For_Backward_Compatibility">
		<TargetFramework>net45</TargetFramework>
	</PropertyGroup>
	<!--Starting Prime 7.0 this file will be generated by the Prime.Kernel.TestMethodResources.Release package to set the TargetFramework -->
	<Import Project="$(SolutionDir)Prime.Release.Settings.props" Condition="Exists('$(SolutionDir)Prime.Release.Settings.props')"/>
	<PropertyGroup>
		<PlatformTarget>x64</PlatformTarget>
		<PrimeVersion>*-*</PrimeVersion>
	</PropertyGroup>
	<ItemGroup>
		<PackageReference Include="Prime.UserCode.Settings" Version="*"/>
		<AdditionalFiles Include="$(MSBuildThisFileDirectory)StyleCop.json">
			<Link>StyleCop.json</Link>
		</AdditionalFiles>
	</ItemGroup>
	<PropertyGroup>
		<AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
		<TreatWarningsAsErrors>true</TreatWarningsAsErrors>
		<GenerateDocumentationFile>true</GenerateDocumentationFile>
		<ErrorReport>prompt</ErrorReport>
		<AutoGenerateBindingRedirects>false</AutoGenerateBindingRedirects>
		<WarningLevel>4</WarningLevel>
		<Copyright>Copyright Â©  2021</Copyright>
		<OutDir Condition="!$(MSBuildProjectName.EndsWith('.UnitTest'))">$(SolutionDir)lib\</OutDir>
		<OutDir Condition="$(MSBuildProjectName.EndsWith('.UnitTest'))">$(SolutionDir)UnitTests\</OutDir>
		<DocumentationFile>$(OutDir)$(MSBuildProjectName).doc.xml</DocumentationFile>
		<TargetPath>$(Outdir)$(AssemblyName).dll</TargetPath> <!-- Re-populate TargetPath after changing the OutDir. Otherwise UT project won't "see" the target project .dll-->
	</PropertyGroup>
	
	<ItemGroup Condition="!$(MSBuildProjectName.EndsWith('.UnitTest'))"> <!--User Code Project Only-->
		<PackageReference Include="Prime.Kernel.TestMethodResources.Release" Version="$(PrimeVersion)" >
			<PrivateAssets>all</PrivateAssets>
			<ExcludeAssets>runtime</ExcludeAssets>
		</PackageReference>
		<PackageReference Include="MPE.MIT.ATE_TM.PrimePHGenerator"  Version="[2.*,3.0.0)" />
	</ItemGroup>
	<ItemGroup Condition="$(MSBuildProjectName.EndsWith('.UnitTest'))"> <!--Unit Test Project Only-->
		<PackageReference Include="Prime.Kernel.TestMethodResources.Release" Version="$(PrimeVersion)" />
		<PackageReference Include="Moq" Version="4.13.1" />
		<PackageReference Include="MSTest.TestAdapter" Version="2.0.0" />
		<PackageReference Include="MSTest.TestFramework" Version="2.0.0" />
		<PackageReference Include="Microsoft.NET.Test.Sdk" Version="16.5.0" />
		<PackageReference Include="coverlet.collector" Version="1.2.0" />
	</ItemGroup>
	<ItemGroup>
		<PackageReference Include="StyleCop.Analyzers">
			<Version>1.1.118</Version>
			<IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
			<PrivateAssets>all</PrivateAssets>
		</PackageReference>
		<Reference Include="Microsoft.CSharp" />
		<Reference Include="System.Data.DataSetExtensions" />
		<Reference Include="System.Net.Http" />
	</ItemGroup>

	<!-- This section below added to simplify the required customization when using Microsoft.ML-->
	<ItemGroup Condition="$(UseMicrosoftML)=='true'">
		<PackageReference Include="Microsoft.ML" Version="1.6.0" GeneratePathProperty="true"/>
		<MlNativedlls Include="$(PkgMicrosoft_ML)\runtimes\win-x64\native\*.dll"/>

		<PackageReference Include="Microsoft.ML.CpuMath" Version="1.6.0" GeneratePathProperty="true" />
		<MlNativedlls Include="$(PkgMicrosoft_ML_CpuMath)\runtimes\win-x64\nativeassets\netstandard2.0\*.dll"/>

		<PackageReference Include="Newtonsoft.Json" Version="$(NewtonsoftJsonVersion)" />

		<PackageReference Include="System.Runtime.CompilerServices.Unsafe" Version="4.7.0" Condition="$(TOSVersion)==''"/> <!-- Default (same as TOS39)-->
		<PackageReference Include="System.Runtime.CompilerServices.Unsafe" Version="4.7.0" Condition="$(TOSVersion)=='TOS39'"/>
		<PackageReference Include="System.Runtime.CompilerServices.Unsafe" Version="4.5.3" Condition="$(TOSVersion)=='TOS37'"/>
	</ItemGroup>

	<Target Name="CopyMLNativeFiles" AfterTargets="Build" Condition="$(UseMicrosoftML)=='true'">
		<Copy SourceFiles="@(MlNativedlls)" DestinationFolder="$(OutDir)"/>
		<Error Text="Uknown value for property TOSVersion=$(TOSVersion)" Condition="$(TOSVersion)!='' AND $(TOSVersion)!='TOS39' AND $(TOSVersion)!='TOS37'"/>
	</Target>
	<!-- End of Microsoft.ML customization-->

</Project>